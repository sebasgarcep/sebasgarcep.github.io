<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Understanding the Kalman Filter" /><meta property="og:locale" content="en" /><meta name="description" content="Society depends on having correct estimates of what may happen. Whether it is the climate or traffic, humans have built models of reality which help us make better decisions. But any model is bound to have a margin of error with respect to reality, and as time passes the model will diverge from reality. To prevent this we would like to integrate observations from reality into the model from time to time. But we run into the problem that observations of reality are often incomplete or have a margin of error themselves. The Kalman Filter is a method of combining both sources of information (model state with observations) in a way that reduces the margin of error in the output." /><meta property="og:description" content="Society depends on having correct estimates of what may happen. Whether it is the climate or traffic, humans have built models of reality which help us make better decisions. But any model is bound to have a margin of error with respect to reality, and as time passes the model will diverge from reality. To prevent this we would like to integrate observations from reality into the model from time to time. But we run into the problem that observations of reality are often incomplete or have a margin of error themselves. The Kalman Filter is a method of combining both sources of information (model state with observations) in a way that reduces the margin of error in the output." /><link rel="canonical" href="https://sebasgarcep.github.io/posts/kalman-filter-tutorial/" /><meta property="og:url" content="https://sebasgarcep.github.io/posts/kalman-filter-tutorial/" /><meta property="og:site_name" content="Sebastian Garrido" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-08T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Understanding the Kalman Filter" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"headline":"Understanding the Kalman Filter","dateModified":"2022-01-08T00:00:00-05:00","datePublished":"2022-01-08T00:00:00-05:00","description":"Society depends on having correct estimates of what may happen. Whether it is the climate or traffic, humans have built models of reality which help us make better decisions. But any model is bound to have a margin of error with respect to reality, and as time passes the model will diverge from reality. To prevent this we would like to integrate observations from reality into the model from time to time. But we run into the problem that observations of reality are often incomplete or have a margin of error themselves. The Kalman Filter is a method of combining both sources of information (model state with observations) in a way that reduces the margin of error in the output.","url":"https://sebasgarcep.github.io/posts/kalman-filter-tutorial/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://sebasgarcep.github.io/posts/kalman-filter-tutorial/"},"@context":"https://schema.org"}</script><title>Understanding the Kalman Filter | Sebastian Garrido</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Sebastian Garrido"><meta name="application-name" content="Sebastian Garrido"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Sebastian Garrido</a></div><div class="site-subtitle font-italic">Data Engineer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/sebasgarcep" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://www.linkedin.com/in/sebastian-garrido-cepeda-20b090152/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['sebasgarcep','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Understanding the Kalman Filter</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img data-src="/assets/img/2022-01-08-kalman-filter/preview.jpg" class="preview-img bg" alt="Boats on a lake" data-proofer-ignore><h1 data-toc-skip>Understanding the Kalman Filter</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/sebasgarcep">Sebastian Garrido</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-01-08 00:00:00 -0500" data-toggle="tooltip" data-placement="bottom" title="Sat, Jan 8, 2022, 12:00 AM -0500" >Jan 8, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2260 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><p>Society depends on having correct estimates of what may happen. Whether it is the climate or traffic, humans have built models of reality which help us make better decisions. But any model is bound to have a margin of error with respect to reality, and as time passes the model will diverge from reality. To prevent this we would like to integrate observations from reality into the model from time to time. But we run into the problem that observations of reality are often incomplete or have a margin of error themselves. The Kalman Filter is a method of combining both sources of information (model state with observations) in a way that reduces the margin of error in the output.</p><p>This post will introduce the Kalman Filter, prove it and implement it in Rust. If you are uncomfortable with math, this is the moment to back out or jump to the implementation part as the presentation will be math-heavy.</p><h1 id="introducing-the-kalman-filter">Introducing the Kalman Filter</h1><p>Assume that a variable $x \in \mathbb{R}^m$ models the state of a system that evolves over time. At a time step $t$ we have an estimation of the current state we will call $x_{\text{esti}}$. We have a linear map $F$ that helps us predict the next state of the system $x_{\text{pred}} := F x_{\text{esti}}$, and we have a measurement of the next state of the system $z \in \mathbb{R}^n$. Notice that the measurement uses another letter. This is to denote the fact that the oberservation and the model state are not necessarily on the same space, e.g. the observation may have lower dimensionality. Assume there is a linear function $H$ that maps from model space to observation space.</p><p>Now we need to understand and model all our sources of uncertainty. To simplify things we will assume all errors are normally distributed with mean zero. This is not always true, but it is a robust enough assumption that even when it doesn’t hold the Kalman Filter still provides good enough results. Firstly, the model state will always have a discrepancy with the real system. Let $P_{\text{esti}}$ be the covariance matrix of the model state noise. Secondly, physical observations have a degree of uncertainty as no real-life tool is perfect. Let $R$ describe the covariance matrix of the observation noise. Finally, our prediction function will rarely be a complete model of reality and this discrepancy will introduce errors into the calculations. Let $Q$ be the covariance matrix of process noise.</p><p>With all the setup out of the way we can introduce the Kalman Filter Equations. First consider the equations that propagate the model state and covariance</p>\[\begin{align*} x_{\text{pred}} &amp;= F x_{\text{esti}} \\ P_{\text{pred}} &amp;= F P_{\text{esti}} F^T + Q \\ \end{align*}\]<p>Now, let the Kalman Gain $K$ be</p>\[K = P_{\text{pred}} H^T (H P_{\text{pred}} H^T + R)^{-1}\]<p>Then the correction in model state $x_{\text{corr}}$ and covariance $P_{\text{corr}}$ obtained by applying the Kalman Filter is given by the following set of formulas</p>\[\begin{align*} x_{\text{corr}} &amp;= x_{\text{pred}} + K (z - H x_{\text{pred}}) \\ P_{\text{corr}} &amp;= (I - K H) P_{\text{pred}} (I - K H)^T + K R K^T \end{align*}\]<p>Which we will formally prove in the next section.</p><h2 id="deriving-the-kalman-filter">Deriving the Kalman Filter<a href="#deriving-the-kalman-filter" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>From the setup we have that $x_{\text{pred}}$ is sampled from $\mathcal{N}(x_{\text{real}}, P_{\text{pred}})$ and $z$ is sampled from $\mathcal{N}(H x_{\text{real}}, R)$. We cannot use these expressions to find $x_{\text{real}}$ but we can find a good approximation $x_{\text{corr}}$. Consider the following expression given by maximum likelihood estimation:</p>\[\frac{1}{\sqrt{(2 \pi)^m |P_{\text{pred}}|}} e^{-\frac{1}{2} (x_{\text{pred}} - x_{\text{corr}})^T P_{\text{pred}}^{-1} (x_{\text{pred}} - x_{\text{corr}})} \cdot \frac{1}{\sqrt{(2 \pi)^n |R|}} e^{-\frac{1}{2} (z - H x_{\text{corr}})^T R^{-1} (z - H x_{\text{corr}})}\]<p>which can be rewritten to</p>\[\frac{1}{\sqrt{(2 \pi)^{m + n} |P_{\text{pred}}| |R|}} e^{-\frac{1}{2} ((x_{\text{pred}} - x_{\text{corr}})^T P_{\text{pred}}^{-1} (x_{\text{pred}} - x_{\text{corr}}) + (z - H x_{\text{corr}})^T R^{-1} (z - H x_{\text{corr}}))}\]<p>We would like to find the value of $x_{\text{corr}}$ that optimizes the previous expression. For that we need to optimize the argument of the exponential function:</p>\[(x_{\text{pred}} - x_{\text{corr}})^T P_{\text{pred}}^{-1} (x_{\text{pred}} - x_{\text{corr}}) + (z - H x_{\text{corr}})^T R^{-1} (z - H x_{\text{corr}})\]<p>To find the optimal value of $x_{\text{corr}}$ we derive this expression with respect to it and equate the result to zero. We are left with the following equation</p>\[\begin{align*} &amp;0 = -2 (x_{\text{pred}} - x_{\text{corr}})^T P_{\text{pred}}^{-1} - 2 (z - H x_{\text{corr}})^T R^{-1} H \\ &amp;\Rightarrow 0 = (x_{\text{pred}} - x_{\text{corr}})^T P_{\text{pred}}^{-1} + (z - H x_{\text{corr}})^T R^{-1} H \\ &amp;\Rightarrow 0 = P_{\text{pred}}^{-T} (x_{\text{pred}} - x_{\text{corr}}) + H^T R^{-T} (z - H x_{\text{corr}}) \\ &amp;\Rightarrow 0 = P_{\text{pred}}^{-1} (x_{\text{pred}} - x_{\text{corr}}) + H^T R^{-1} (z - H x_{\text{corr}}) \\ &amp;\Rightarrow (P_{\text{pred}}^{-1} + H^T R^{-1} H) x_{\text{corr}} = P_{\text{pred}}^{-1} x_{\text{pred}} + H^T R^{-1} z \\ &amp;\Rightarrow x_{\text{corr}} = (P_{\text{pred}}^{-1} + H^T R^{-1} H)^{-1} (P_{\text{pred}}^{-1} x_{\text{pred}} + H^T R^{-1} z) \\ \end{align*}\]<p>An application of the <a href="https://en.wikipedia.org/wiki/Woodbury_matrix_identity">Woodbury matrix identity</a> shows that</p>\[(P_{\text{pred}}^{-1} + H^T R^{-1} H)^{-1} = P_{\text{pred}} - P_{\text{pred}} H^T (H P_{\text{pred}} H^T + R)^{-1} H P_{\text{pred}} = P_{\text{pred}} - K H P_{\text{pred}}\]<p>where the last part follows from the definition of the Kalman Gain $K$. Therefore</p>\[\begin{align*} &amp;x_{\text{corr}} = (P_{\text{pred}}^{-1} + H^T R^{-1} H)^{-1} (P_{\text{pred}}^{-1} x_{\text{pred}} + H^T R^{-1} z) \\ &amp;\Rightarrow x_{\text{corr}} = (P_{\text{pred}} - K H P_{\text{pred}}) \cdot (P_{\text{pred}}^{-1} x_{\text{pred}} + H^T R^{-1} z) \\ &amp;\Rightarrow x_{\text{corr}} = x_{\text{pred}} - K H x_{\text{pred}} + (P_{\text{pred}} H^T R^{-1} - K H P_{\text{pred}} H^T R^{-1}) z \\ \end{align*}\]<p>But</p>\[\begin{align*} &amp;K = P_{\text{pred}} H^T (H P_{\text{pred}} H^T + R)^{-1} \\ &amp;\Rightarrow K (H P_{\text{pred}} H^T + R) = P_{\text{pred}} H^T \\ &amp;\Rightarrow K H P_{\text{pred}} H^T = P_{\text{pred}} H^T - K R \\ \end{align*}\]<p>Which applied to the previous formula yields</p>\[\begin{align*} &amp;x_{\text{corr}} = x_{\text{pred}} - K H x_{\text{pred}} + (P_{\text{pred}} H^T R^{-1} - K H P_{\text{pred}} H^T R^{-1}) z \\ &amp;\Rightarrow x_{\text{corr}} = x_{\text{pred}} - K H x_{\text{pred}} + (P_{\text{pred}} H^T R^{-1} - (P_{\text{pred}} H^T - K R) R^{-1}) z \\ &amp;\Rightarrow x_{\text{corr}} = x_{\text{pred}} - K H x_{\text{pred}} + (P_{\text{pred}} H^T R^{-1} - P_{\text{pred}} H^T R^{-1} + K) z \\ &amp;\Rightarrow x_{\text{corr}} = x_{\text{pred}} - K H x_{\text{pred}} + K z \\ &amp;\Rightarrow x_{\text{corr}} = x_{\text{pred}} + K (z - H x_{\text{pred}}) \\ \end{align*}\]<p>which proves the first of the update formulas. The second results from noticing that the previous formula can be rewritten as</p>\[x_{\text{corr}} = (I - K H) x_{\text{pred}} + K z\]<p>and therefore the update formula for the covariance is</p><p>\(P_{\text{corr}} = (I - K H) P_{\text{pred}} (I - K H)^T + K R K^T\)d</p><p>which finalizes the proof.</p><h2 id="applying-the-kalman-filter">Applying the Kalman Filter<a href="#applying-the-kalman-filter" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Suppose we have a signal-repeating satellite orbiting around the Earth. Thanks to <a href="https://en.wikipedia.org/wiki/Kepler's_laws_of_planetary_motion">Kepler’s laws of planetary motion</a> we know that this orbit is elliptical, with the Earth at one of its foci. Any ellipse can be described by its semimajor axis $a$ (half the length of its largest diameter) and its semiminor axis $b$ (half the length of its smallest diameter). The focal distance (distance from the center of the ellipse to either of the foci) can be found with the formula $c = \sqrt{a^2 - b^2}$. The orbit of the satellite and the position of the Earth relative to it will look something like this plot:</p><p><img data-src="/assets/img/2022-01-08-kalman-filter-tutorial/real_orbit.svg" alt="Real Orbit with Earth at its Foci" data-proofer-ignore></p><p>Because we have a signal-repeating satellite orbiting the earth, we can measure how far away from the Earth it is by bouncing a signal and measuring how long it takes to come back (the signal will travel at the speed of light). We can use this tool to measure the periapsis (closest distance to Earth) and apoapsis of the orbit (furthest away from Earth). Clearly</p>\[\begin{align*} \text{periapsis} &amp;= a - c \\ \text{apoapsis} &amp;= a + c \\ \end{align*}\]<p>and we can solve this system of equations to obtain the values of $a$ and $c$. The value of $b$ can be obtained by using the formula $c = \sqrt{a^2 - b^2}$. With this information we can model the <a href="https://en.wikipedia.org/wiki/Kepler's_laws_of_planetary_motion#Position_as_a_function_of_time">orbit of the satellite</a> by solving <a href="https://en.wikipedia.org/wiki/Kepler%27s_equation#Numerical_approximation_of_inverse_problem">Kepler’s equation</a>.</p><p>In real life we are going to face the problem that the measurement of the periapsis and apoapsis will be noisy, which means we won’t have a perfect approximation of the orbit of the satellite. We also cannot constantly measure the position of the satellite in space (using the distance and the angle relative to Earth) as each measurement will have some amount of noise to it, and the farther away the satellite is, the noisier the measurements get. We can observe this behaviour in the following graph</p><p><img data-src="/assets/img/2022-01-08-kalman-filter-tutorial/meas_orbit.svg" alt="Real Orbit with Measurements" data-proofer-ignore></p><p>Using the Kalman Filter we can combine both sources of information though (model state and measurements) to obtain better results.</p><p>We will model the motion of the satellite using a constant position model, i.e. we will set $F$ to be the identity map. This may seem like an inappropiate choice, but later on we will show that it gives good enough results for a short exercise like this. We will set $Q = \sigma I$, where sigma is the uncertainty in distance measurements.</p><p>The satellite gives us a distance-angle reading which satify the hypothesis that the error in our observations should Gaussian with zero mean. We will not use this observation directly in the Kalman Filter. The reason is that two angles can be physically very close and numerically very far away, e.g. doing two and a half turns around the circle gives the same angle as doing just half a turn, but numerically they are distinct by $4 \pi$ radians. This will give us problems later on when we calculate $z - H x_{\text{pred}}$ in the Kalman Filter equations. Instead we will map this observation into cartesian coordinates. Therefore the observation map $H$ is the identity map.</p><p>Notice that this operation on the observation transforms the distribution of our errors. Specifically, the further away we get from the foci, the larger the errors get, as we can see in the above graph. We can get around this by scaling $R$ by the distance squared between the satellite and the Earth.</p><p>With all this setup done we can now implement the Kalman Filter and our model.</p><h2 id="rust-implementation">Rust Implementation<a href="#rust-implementation" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Let’s start by implementing the Kalman Filter as a Trait:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="k">crate</span><span class="p">::</span><span class="nn">types</span><span class="p">::{</span><span class="n">ArrayMatrix</span><span class="p">,</span> <span class="n">ArrayVector</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">nalgebra</span><span class="p">::</span><span class="n">DMatrix</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">trait</span> <span class="n">KalmanFilterModel</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">predict_mat</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">ArrayVector</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ArrayMatrix</span><span class="p">;</span>
    <span class="k">fn</span> <span class="nf">predict_cov</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">ArrayVector</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ArrayMatrix</span><span class="p">;</span>

    <span class="k">fn</span> <span class="nf">observe_mat</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">ArrayVector</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ArrayMatrix</span><span class="p">;</span>
    <span class="k">fn</span> <span class="nf">observe_cov</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">ArrayVector</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ArrayMatrix</span><span class="p">;</span>

    <span class="k">fn</span> <span class="nf">predict</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">ArrayVector</span><span class="p">,</span> <span class="n">p_inpt</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">ArrayMatrix</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="n">ArrayVector</span><span class="p">,</span> <span class="n">ArrayMatrix</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">f</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.predict_mat</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">q</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.predict_cov</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">x_pred</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">f</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">p_pred</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">f</span> <span class="o">*</span> <span class="n">p_inpt</span> <span class="o">*</span> <span class="o">&amp;</span><span class="n">f</span><span class="nf">.transpose</span><span class="p">()</span> <span class="o">+</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">;</span>

        <span class="p">(</span><span class="n">x_pred</span><span class="p">,</span> <span class="n">p_pred</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">update</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">ArrayVector</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">ArrayMatrix</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">ArrayVector</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="n">ArrayVector</span><span class="p">,</span> <span class="n">ArrayMatrix</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">model_size</span> <span class="o">=</span> <span class="n">x</span><span class="nf">.len</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">i</span><span class="p">:</span> <span class="n">ArrayMatrix</span> <span class="o">=</span> <span class="nn">DMatrix</span><span class="p">::</span><span class="nf">identity</span><span class="p">(</span><span class="n">model_size</span><span class="p">,</span> <span class="n">model_size</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">h</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.observe_mat</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">r</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.observe_cov</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">k</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="o">&amp;</span><span class="n">h</span><span class="nf">.transpose</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">h</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="o">&amp;</span><span class="n">h</span><span class="nf">.transpose</span><span class="p">()</span> <span class="o">+</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">)</span><span class="nf">.try_inverse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
        
        <span class="k">let</span> <span class="n">x_hat</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="o">&amp;</span><span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="o">&amp;</span><span class="n">h</span> <span class="o">*</span> <span class="n">x</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">p_hat</span> <span class="o">=</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">i</span> <span class="o">-</span> <span class="o">&amp;</span><span class="n">k</span> <span class="o">*</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">i</span> <span class="o">-</span> <span class="o">&amp;</span><span class="n">k</span> <span class="o">*</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span><span class="nf">.transpose</span><span class="p">()</span> <span class="o">+</span> <span class="o">&amp;</span><span class="n">k</span> <span class="o">*</span> <span class="o">&amp;</span><span class="n">r</span> <span class="o">*</span> <span class="o">&amp;</span><span class="n">k</span><span class="nf">.transpose</span><span class="p">();</span>
    
        <span class="p">(</span><span class="n">x_hat</span><span class="p">,</span> <span class="n">p_hat</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This allows each model to provide its own implementation of the $F$ (<code class="language-plaintext highlighter-rouge">predict_mat</code>), $Q$ (<code class="language-plaintext highlighter-rouge">predict_cov</code>), $H$ (<code class="language-plaintext highlighter-rouge">observe_mat</code>) and $R$ (<code class="language-plaintext highlighter-rouge">observe_cov</code>) matrices while allowing us to define a default behaviour for the <code class="language-plaintext highlighter-rouge">predict</code> and <code class="language-plaintext highlighter-rouge">update</code> equations.</p><p>Our model, which we named <code class="language-plaintext highlighter-rouge">ConstantOrbitModel</code> has the following implementation:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="k">crate</span><span class="p">::</span><span class="nn">filters</span><span class="p">::</span><span class="n">KalmanFilterModel</span><span class="p">;</span>
<span class="k">use</span> <span class="k">crate</span><span class="p">::</span><span class="nn">types</span><span class="p">::{</span><span class="n">ArrayMatrix</span><span class="p">,</span> <span class="n">ArrayVector</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">nalgebra</span><span class="p">::{</span><span class="n">dmatrix</span><span class="p">,</span> <span class="n">DMatrix</span><span class="p">};</span>

<span class="k">pub</span> <span class="k">struct</span> <span class="n">ConstantOrbitModel</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="n">position_noise</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">e_meas</span><span class="p">:</span> <span class="n">ArrayVector</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">ConstantOrbitModel</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span>
        <span class="n">position_noise</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
        <span class="n">e_meas</span><span class="p">:</span> <span class="n">ArrayVector</span><span class="p">,</span>
    <span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="n">ConstantOrbitModel</span> <span class="p">{</span>
            <span class="n">position_noise</span><span class="p">,</span>
            <span class="n">e_meas</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">KalmanFilterModel</span> <span class="k">for</span> <span class="n">ConstantOrbitModel</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">predict_mat</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">_x</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">ArrayVector</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ArrayMatrix</span> <span class="p">{</span>
        <span class="nn">DMatrix</span><span class="p">::</span><span class="nf">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">predict_cov</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">_x</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">ArrayVector</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ArrayMatrix</span> <span class="p">{</span>
        <span class="nd">dmatrix!</span><span class="p">[</span>
            <span class="k">self</span><span class="py">.position_noise</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">;</span>
            <span class="mf">0.0</span><span class="p">,</span> <span class="k">self</span><span class="py">.position_noise</span><span class="p">;</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">observe_mat</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">_x</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">ArrayVector</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ArrayMatrix</span> <span class="p">{</span>
        <span class="nn">DMatrix</span><span class="p">::</span><span class="nf">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">observe_cov</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">ArrayVector</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ArrayMatrix</span> <span class="p">{</span>
        <span class="nd">dmatrix!</span><span class="p">[</span>
            <span class="k">self</span><span class="py">.position_noise</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.e_meas</span><span class="p">)</span><span class="nf">.norm_squared</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">;</span>
            <span class="mf">0.0</span><span class="p">,</span> <span class="k">self</span><span class="py">.position_noise</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.e_meas</span><span class="p">)</span><span class="nf">.norm_squared</span><span class="p">();</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>which does the same things we discussed in the previous section.</p><p>Finally we implement the orbit simulation and the functions that output the results to the SVG graphs you are seeing. I will not discuss those parts here, as they are outside the scope of the tutorial, but you can take a look at the complete source code <a href="https://github.com/sebasgarcep/kalman-filter-tutorial">here</a>.</p><h2 id="conclusion">Conclusion<a href="#conclusion" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>After implementing the Kalman Filter we obtain the following results</p><p><img data-src="/assets/img/2022-01-08-kalman-filter-tutorial/corr_orbit.svg" alt="Applying Kalman Filter Corrections" data-proofer-ignore></p><p>The green line shows the measurements over time, and the yellow line shows the orbit predicted by our Kalman Filter model. As we can see it is far more stable and a better approximation of the real orbit than the measurements themselves. In fact the relative error rate over time is far smaller with the Kalman Filter corrections than without them:</p><p><img data-src="/assets/img/2022-01-08-kalman-filter-tutorial/error.svg" alt="Relative error rates over time" data-proofer-ignore></p><p>And this is with a constant position model! With better models or numerical stabilization procedures we are sure to obtain even better results. This is the power of the Kalman Filter.</p><p>I hope that this article gave you a better understanding of the Kalman Filter and that you may be able to apply it to your projects soon.</p><h2 id="references">References<a href="#references" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="https://github.com/sebasgarcep/kalman-filter-tutorial">Source code for the tutorial</a><li><a href="http://web.mit.edu/kirtley/kirtley/binlustuff/literature/control/Kalman%20filter.pdf">http://web.mit.edu/kirtley/kirtley/binlustuff/literature/control/Kalman%20filter.pdf</a><li><a href="https://en.wikipedia.org/wiki/Kalman_filter">https://en.wikipedia.org/wiki/Kalman_filter</a><li><a href="https://en.wikipedia.org/wiki/Woodbury_matrix_identity">https://en.wikipedia.org/wiki/Woodbury_matrix_identity</a><li><a href="https://en.wikipedia.org/wiki/Kepler's_laws_of_planetary_motion">https://en.wikipedia.org/wiki/Kepler’s_laws_of_planetary_motion</a><li><a href="https://en.wikipedia.org/wiki/Kepler's_laws_of_planetary_motion#Position_as_a_function_of_time">https://en.wikipedia.org/wiki/Kepler’s_laws_of_planetary_motion#Position_as_a_function_of_time</a><li><a href="https://en.wikipedia.org/wiki/Kepler%27s_equation#Numerical_approximation_of_inverse_problem">https://en.wikipedia.org/wiki/Kepler%27s_equation#Numerical_approximation_of_inverse_problem</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/mathematics/" class="post-tag no-text-decoration" >Mathematics</a> <a href="/tags/data-assimilation/" class="post-tag no-text-decoration" >Data Assimilation</a> <a href="/tags/kalman-filter/" class="post-tag no-text-decoration" >Kalman Filter</a> <a href="/tags/rust/" class="post-tag no-text-decoration" >Rust</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Understanding the Kalman Filter - Sebastian Garrido&url=https://sebasgarcep.github.io/posts/kalman-filter-tutorial/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Understanding the Kalman Filter - Sebastian Garrido&u=https://sebasgarcep.github.io/posts/kalman-filter-tutorial/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Understanding the Kalman Filter - Sebastian Garrido&url=https://sebasgarcep.github.io/posts/kalman-filter-tutorial/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://sebasgarcep.github.io/posts/kalman-filter-tutorial/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/from-zero-to-data-ready-part-1/">From Zero to Data-Ready (Part 1): Exploratory Data Analysis</a><li><a href="/posts/from-zero-to-data-ready-part-2/">From Zero to Data-Ready (Part 2): Building a SQL Data Warehouse</a><li><a href="/posts/from-zero-to-data-ready-part-3/">From Zero to Data-Ready (Part 3): Writing Test Driven ETLs using Python</a><li><a href="/posts/from-zero-to-data-ready-part-4/">From Zero to Data-Ready (Part 4): Building Analytics Dashboards using CubeJS and React</a><li><a href="/posts/counting-primes-really-fast/">Counting Primes Really Fast</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/data-engineering/">Data Engineering</a> <a class="post-tag" href="/tags/from-zero-to-data-ready/">From Zero to Data-Ready</a> <a class="post-tag" href="/tags/retail-project/">Retail Project</a> <a class="post-tag" href="/tags/mathematics/">Mathematics</a> <a class="post-tag" href="/tags/postgres/">Postgres</a> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/rust/">Rust</a> <a class="post-tag" href="/tags/sql/">SQL</a> <a class="post-tag" href="/tags/cubejs/">CubeJS</a> <a class="post-tag" href="/tags/data-assimilation/">Data Assimilation</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/counting-primes-really-fast/"><div class="card-body"> <em class="timeago small" date="2021-06-28 00:00:00 -0500" >Jun 28, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Counting Primes Really Fast</h3><div class="text-muted small"><p> Suppose you are given a very large number, for example $n = 10^{12}$, and you wish to know how many numbers equal to or less than $n$ are prime. This is the prime counting function, normally denote...</p></div></div></a></div><div class="card"> <a href="/posts/social-login-app/"><div class="card-body"> <em class="timeago small" date="2022-01-03 00:00:00 -0500" >Jan 3, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Writing a React Native App using Expo and Google Social Login</h3><div class="text-muted small"><p> This will be a brief tutorial on how to write a React Native application, using Expo, that implements Social Authentication, using Google. We will use ExpressJS and Passport in the backend to manag...</p></div></div></a></div><div class="card"> <a href="/posts/from-zero-to-data-ready-part-4/"><div class="card-body"> <em class="timeago small" date="2021-06-18 00:00:00 -0500" >Jun 18, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>From Zero to Data-Ready (Part 4): Building Analytics Dashboards using CubeJS and React</h3><div class="text-muted small"><p> In Part 3 we wrote our ETLs using Python and TDD. In this post we will focus on building an analytics platform for the company using CubeJS. What is CubeJS ? CubeJS is a tool that serves as a bac...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/social-login-app/" class="btn btn-outline-primary" prompt="Older"><p>Writing a React Native App using Expo and Google Social Login</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/sebasgarcep">Sebastian Garrido</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/data-engineering/">Data Engineering</a> <a class="post-tag" href="/tags/from-zero-to-data-ready/">From Zero to Data-Ready</a> <a class="post-tag" href="/tags/retail-project/">Retail Project</a> <a class="post-tag" href="/tags/mathematics/">Mathematics</a> <a class="post-tag" href="/tags/postgres/">Postgres</a> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/rust/">Rust</a> <a class="post-tag" href="/tags/sql/">SQL</a> <a class="post-tag" href="/tags/cubejs/">CubeJS</a> <a class="post-tag" href="/tags/data-assimilation/">Data Assimilation</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
